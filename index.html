<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>現在地マップ（iPhone対応）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    #map { width: 100vw; height: 100vh; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script>
    const map = new maplibregl.Map({
      container: 'map',
      style: {
        version: 8,
        sources: {
          gsi_pale: {
            type: 'raster',
            tiles: [
              'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png'
            ],
            tileSize: 256,
            attribution:
              '地図データ: <a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">国土地理院</a>'
          }
        },
        layers: [
          {
            id: 'gsi-pale-layer',
            type: 'raster',
            source: 'gsi_pale',
            minzoom: 0,
            maxzoom: 18
          }
        ]
      },
      center: [139.767, 35.681],
      zoom: 14
    });

    map.addControl(new maplibregl.NavigationControl());

    navigator.geolocation.getCurrentPosition(
      (position) => {
        const lng = position.coords.longitude;
        const lat = position.coords.latitude;

        map.setCenter([lng, lat]);

        new maplibregl.Marker({ color: '#007AFF' }) // 青いピン
          .setLngLat([lng, lat])
          .addTo(map);
      },
      (error) => {
        alert('現在地を取得できませんでした。有楽町駅を表示します。');

        const fallbackLng = 139.763328;
        const fallbackLat = 35.675069;

        map.setCenter([fallbackLng, fallbackLat]);

        new maplibregl.Marker({ color: '#FF3B30' }) // 赤いピン
          .setLngLat([fallbackLng, fallbackLat])
          .addTo(map);
      }
    );
  </script>
</body>
</html>
